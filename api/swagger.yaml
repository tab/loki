openapi: "3.0.0"
info:
  title: "Loki API"
  version: "1.0.0"
  description: "Loki API authentication via Smart-ID and Mobile-ID"
servers:
  - url: "http://localhost:8080"
paths:
  /api/auth/smart_id:
    post:
      summary: "Create a Smart-ID authentication session"
      description: "Initiates a Smart-ID authentication session using personal code and country"
      tags:
        - smart_id
      parameters:
        - name: X-Trace-ID
          in: header
          schema:
            $ref: "#/components/schemas/TraceId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateSmartIdSessionRequest"
            examples:
              OK:
                summary: "Successfully create a smart-id session example"
                description: "Example of requesting a Smart-ID session creation"
                value:
                  country: "EE"
                  personal_code: "50001029996"
              USER_REFUSED:
                summary: "Create a smart-id session example with user refusal"
                description: "Example of requesting a Smart-ID session creation with user refusal"
                value:
                  country: "EE"
                  personal_code: "30403039917"
              USER_REFUSED_DISPLAYTEXTANDPIN:
                summary: "Create a smart-id session example with user refusal and display text and PIN"
                description: "Example of requesting a Smart-ID session creation with user refusal and display text and PIN"
                value:
                  country: "EE"
                  personal_code: "30403039928"
              USER_REFUSED_VC_CHOICE:
                summary: "Create a smart-id session example with user refusal and VC choice"
                description: "Example of requesting a Smart-ID session creation with user refusal and VC choice"
                value:
                  country: "EE"
                  personal_code: "30403039939"
              USER_REFUSED_CONFIRMATIONMESSAGE:
                summary: "Create a smart-id session example with user refusal and confirmation message"
                description: "Example of requesting a Smart-ID session creation with user refusal and confirmation message"
                value:
                  country: "EE"
                  personal_code: "30403039946"
              USER_REFUSED_CONFIRMATIONMESSAGE_WITH_VC_CHOICE:
                summary: "Create a smart-id session example with user refusal, confirmation message and VC choice"
                description: "Example of requesting a Smart-ID session creation with user refusal, confirmation message and VC choice"
                value:
                  country: "EE"
                  personal_code: "30403039950"
              USER_REFUSED_CERT_CHOICE:
                summary: "Create a smart-id session example with user refusal and cert choice"
                description: "Example of requesting a Smart-ID session creation with user refusal and cert choice"
                value:
                  country: "EE"
                  personal_code: "30403039961"
              WRONG_VC:
                summary: "Create a smart-id session example with wrong VC"
                description: "Example of requesting a Smart-ID session creation with wrong VC"
                value:
                  country: "EE"
                  personal_code: "30403039972"
              TIMEOUT:
                summary: "Create a smart-id session example with timeout"
                description: "Example of requesting a Smart-ID session creation with timeout"
                value:
                  country: "EE"
                  personal_code: "30403039983"
      responses:
        "201":
          description: "Created"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SessionSerializer"
        "400":
          description: "Bad Request"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "422":
          description: "Unprocessable Entity"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"

  /api/auth/mobile_id:
    post:
      summary: "Create a Mobile-ID authentication session"
      description: "Initiates a Mobile-ID authentication session using personal code and phone number"
      tags:
        - mobile_id
      parameters:
        - name: X-Trace-ID
          in: header
          schema:
            $ref: "#/components/schemas/TraceId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateMobileIdSessionRequest"
            examples:
              OK:
                summary: "Successfully create a mobile-id session example"
                description: "Example of requesting a Mobile-ID session creation"
                value:
                  locale: "ENG"
                  phone_number: "+37268000769"
                  personal_code: "60001017869"
              NOT_MID_CLIENT:
                summary: "Create a mobile-id session example with user not being a MID client"
                description: "Example of requesting a Mobile-ID session creation with user not being a MID client"
                value:
                  locale: "ENG"
                  phone_number: "+37200000266"
                  personal_code: "60001019939"
              DELIVERY_ERROR:
                summary: "Create a mobile-id session example with delivery error"
                description: "Example of requesting a Mobile-ID session creation with delivery error"
                value:
                  locale: "ENG"
                  phone_number: "+37207110066"
                  personal_code: "60001019947"
              USER_CANCELLED:
                summary: "Create a mobile-id session example with user refusal"
                description: "Example of requesting a Mobile-ID session creation with user refusal"
                value:
                  locale: "ENG"
                  phone_number: "+37201100266"
                  personal_code: "60001019950"
              SIGNATURE_HASH_MISMATCH:
                summary: "Create a mobile-id session example with signature hash mismatch"
                description: "Example of requesting a Mobile-ID session creation with signature hash mismatch"
                value:
                  locale: "ENG"
                  phone_number: "+37200000666"
                  personal_code: "60001019961"
              SIM_ERROR:
                summary: "Create a mobile-id session example with SIM error"
                description: "Example of requesting a Mobile-ID session creation with SIM error"
                value:
                  locale: "ENG"
                  phone_number: "+37201200266"
                  personal_code: "60001019972"
              PHONE_ABSENT:
                summary: "Create a mobile-id session example with phone absent"
                description: "Example of requesting a Mobile-ID session creation with phone absent"
                value:
                  locale: "ENG"
                  phone_number: "+37213100266"
                  personal_code: "60001019983"
              TIMEOUT:
                summary: "Create a mobile-id session example with timeout"
                description: "Example of requesting a Mobile-ID session creation with timeout"
                value:
                  locale: "ENG"
                  phone_number: "+37266000266"
                  personal_code: "50001018908"
      responses:
        "201":
          description: "Created"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SessionSerializer"
        "400":
          description: "Bad Request"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "422":
          description: "Unprocessable Entity"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"

  /api/sessions/{id}:
    get:
      summary: "Get the status of an authentication session"
      description: "Retrieves the current status of a session by ID"
      tags:
        - sessions
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: "Session ID"
        - name: X-Trace-ID
          in: header
          schema:
            $ref: "#/components/schemas/TraceId"
      responses:
        "200":
          description: "OK"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SessionSerializer"
        "404":
          description: "Not Found"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "422":
          description: "Unprocessable Entity"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
    post:
      summary: "Complete the authentication session"
      description: "Completes the authentication process using the given session ID and returns user data with tokens"
      tags:
        - sessions
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: "Session ID"
        - name: X-Trace-ID
          in: header
          schema:
            $ref: "#/components/schemas/TraceId"
      responses:
        "200":
          description: "OK"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserSerializer"
        "422":
          description: "Unprocessable Entity"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"

  /api/tokens/refresh:
    post:
      summary: "Refresh tokens by providing a refresh token"
      description: "Refreshes the access token by providing a refresh token"
      tags:
        - tokens
      parameters:
        - name: X-Trace-ID
          in: header
          schema:
            $ref: "#/components/schemas/TraceId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RefreshAccessTokenRequest"
      security:
        - Authentication: []
      responses:
        "200":
          description: "OK"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokensSerializer"
        "401":
          description: "Unauthorized"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "422":
          description: "Unprocessable Entity"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"

  /api/me:
    get:
      summary: "Get current_user information"
      description: "Retrieves the current user information"
      tags:
        - user
      parameters:
        - name: X-Trace-ID
          in: header
          schema:
            $ref: "#/components/schemas/TraceId"
      security:
        - Authentication: []
      responses:
        "200":
          description: "OK"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserSerializer"
        "401":
          description: "Unauthorized"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"

  /api/backoffice/permissions:
    get:
      summary: "List permissions"
      description: "Retrieves a paginated list of permissions"
      tags:
        - backoffice
      parameters:
        - name: X-Trace-ID
          in: header
          schema:
            $ref: "#/components/schemas/TraceId"
        - name: page
          in: query
          schema:
            type: integer
          description: "Page number for pagination"
        - name: per
          in: query
          schema:
            type: integer
          description: "Number of items per page"
      security:
        - Authentication: []
      responses:
        "200":
          description: "OK"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PermissionsListResponse"
        "401":
          description: "Unauthorized"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "422":
          description: "Unprocessable Entity"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
    post:
      summary: "Create a permission"
      description: "Creates a new permission"
      tags:
        - backoffice
      parameters:
        - name: X-Trace-ID
          in: header
          schema:
            $ref: "#/components/schemas/TraceId"
      security:
        - Authentication: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PermissionRequest"
      responses:
        "201":
          description: "Created"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PermissionSerializer"
        "400":
          description: "Bad Request"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "401":
          description: "Unauthorized"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "422":
          description: "Unprocessable Entity"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"

  /api/backoffice/permissions/{id}:
    get:
      summary: "Get a permission"
      description: "Retrieves a permission by its ID"
      tags:
        - backoffice
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: "Permission ID"
        - name: X-Trace-ID
          in: header
          schema:
            $ref: "#/components/schemas/TraceId"
      security:
        - Authentication: []
      responses:
        "200":
          description: "OK"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PermissionSerializer"
        "401":
          description: "Unauthorized"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "404":
          description: "Not Found"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "422":
          description: "Unprocessable Entity"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
    put:
      summary: "Update a permission"
      description: "Updates a permission by its ID"
      tags:
        - backoffice
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: "Permission ID"
        - name: X-Trace-ID
          in: header
          schema:
            $ref: "#/components/schemas/TraceId"
      security:
        - Authentication: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PermissionRequest"
      responses:
        "200":
          description: "OK"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PermissionSerializer"
        "400":
          description: "Bad Request"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "401":
          description: "Unauthorized"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "422":
          description: "Unprocessable Entity"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
    delete:
      summary: "Delete a permission"
      description: "Deletes a permission by its ID"
      tags:
        - backoffice
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: "Permission ID"
        - name: X-Trace-ID
          in: header
          schema:
            $ref: "#/components/schemas/TraceId"
      security:
        - Authentication: []
      responses:
        "204":
          description: "No Content"
        "401":
          description: "Unauthorized"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "422":
          description: "Unprocessable Entity"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"

  /api/backoffice/roles:
    get:
      summary: "List roles"
      description: "Retrieves a paginated list of roles"
      tags:
        - backoffice
      parameters:
        - name: X-Trace-ID
          in: header
          schema:
            $ref: "#/components/schemas/TraceId"
        - name: page
          in: query
          schema:
            type: integer
          description: "Page number for pagination"
        - name: per
          in: query
          schema:
            type: integer
          description: "Number of items per page"
      security:
        - Authentication: []
      responses:
        "200":
          description: "OK"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RolesListResponse"
        "401":
          description: "Unauthorized"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "422":
          description: "Unprocessable Entity"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
    post:
      summary: "Create a role"
      description: "Creates a new role"
      tags:
        - backoffice
      parameters:
        - name: X-Trace-ID
          in: header
          schema:
            $ref: "#/components/schemas/TraceId"
      security:
        - Authentication: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RoleRequest"
      responses:
        "201":
          description: "Created"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RoleSerializer"
        "400":
          description: "Bad Request"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "401":
          description: "Unauthorized"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "422":
          description: "Unprocessable Entity"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"

  /api/backoffice/roles/{id}:
    get:
      summary: "Get a role"
      description: "Retrieves a role by its ID"
      tags:
        - backoffice
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: "Role ID"
        - name: X-Trace-ID
          in: header
          schema:
            $ref: "#/components/schemas/TraceId"
      security:
        - Authentication: []
      responses:
        "200":
          description: "OK"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RoleSerializer"
        "401":
          description: "Unauthorized"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "404":
          description: "Not Found"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "422":
          description: "Unprocessable Entity"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
    put:
      summary: "Update a role"
      description: "Updates a role by its ID"
      tags:
        - backoffice
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: "Role ID"
        - name: X-Trace-ID
          in: header
          schema:
            $ref: "#/components/schemas/TraceId"
      security:
        - Authentication: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RoleRequest"
      responses:
        "200":
          description: "OK"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RoleSerializer"
        "400":
          description: "Bad Request"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "401":
          description: "Unauthorized"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "422":
          description: "Unprocessable Entity"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
    delete:
      summary: "Delete a role"
      description: "Deletes a role by its ID"
      tags:
        - backoffice
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: "Role ID"
        - name: X-Trace-ID
          in: header
          schema:
            $ref: "#/components/schemas/TraceId"
      security:
        - Authentication: []
      responses:
        "204":
          description: "No Content"
        "401":
          description: "Unauthorized"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "422":
          description: "Unprocessable Entity"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"

  /api/backoffice/scopes:
    get:
      summary: "List scopes"
      description: "Retrieves a paginated list of scopes"
      tags:
        - backoffice
      parameters:
        - name: X-Trace-ID
          in: header
          schema:
            $ref: "#/components/schemas/TraceId"
        - name: page
          in: query
          schema:
            type: integer
          description: "Page number for pagination"
        - name: per
          in: query
          schema:
            type: integer
          description: "Number of items per page"
      security:
        - Authentication: []
      responses:
        "200":
          description: "OK"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ScopesListResponse"
        "401":
          description: "Unauthorized"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "422":
          description: "Unprocessable Entity"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
    post:
      summary: "Create a scope"
      description: "Creates a new scope"
      tags:
        - backoffice
      parameters:
        - name: X-Trace-ID
          in: header
          schema:
            $ref: "#/components/schemas/TraceId"
      security:
        - Authentication: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ScopeRequest"
      responses:
        "201":
          description: "Created"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ScopeSerializer"
        "400":
          description: "Bad Request"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "401":
          description: "Unauthorized"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "422":
          description: "Unprocessable Entity"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"

  /api/backoffice/scopes/{id}:
    get:
      summary: "Get a scope"
      description: "Retrieves a scope by its ID"
      tags:
        - backoffice
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: "Scope ID"
        - name: X-Trace-ID
          in: header
          schema:
            $ref: "#/components/schemas/TraceId"
      security:
        - Authentication: []
      responses:
        "200":
          description: "OK"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ScopeSerializer"
        "401":
          description: "Unauthorized"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "404":
          description: "Not Found"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "422":
          description: "Unprocessable Entity"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
    put:
      summary: "Update a scope"
      description: "Updates a scope by its ID"
      tags:
        - backoffice
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: "Scope ID"
        - name: X-Trace-ID
          in: header
          schema:
            $ref: "#/components/schemas/TraceId"
      security:
        - Authentication: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ScopeRequest"
      responses:
        "200":
          description: "OK"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ScopeSerializer"
        "400":
          description: "Bad Request"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "401":
          description: "Unauthorized"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "422":
          description: "Unprocessable Entity"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
    delete:
      summary: "Delete a scope"
      description: "Deletes a scope by its ID"
      tags:
        - backoffice
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: "Scope ID"
        - name: X-Trace-ID
          in: header
          schema:
            $ref: "#/components/schemas/TraceId"
      security:
        - Authentication: []
      responses:
        "204":
          description: "No Content"
        "401":
          description: "Unauthorized"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "422":
          description: "Unprocessable Entity"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"

  /api/backoffice/tokens:
    get:
      summary: "List tokens"
      description: "Retrieves a paginated list of tokens"
      tags:
        - backoffice
      parameters:
        - name: X-Trace-ID
          in: header
          schema:
            $ref: "#/components/schemas/TraceId"
        - name: page
          in: query
          schema:
            type: integer
          description: "Page number for pagination"
        - name: per
          in: query
          schema:
            type: integer
          description: "Number of items per page"
      security:
        - Authentication: []
      responses:
        "200":
          description: "OK"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokensListResponse"
        "401":
          description: "Unauthorized"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "422":
          description: "Unprocessable Entity"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
    delete:
      summary: "Delete a token"
      description: "Deletes a token by its ID"
      tags:
        - backoffice
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: "Token ID"
        - name: X-Trace-ID
          in: header
          schema:
            $ref: "#/components/schemas/TraceId"
      security:
        - Authentication: []
      responses:
        "204":
          description: "No Content"
        "401":
          description: "Unauthorized"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "422":
          description: "Unprocessable Entity"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"

  /api/backoffice/users:
    get:
      summary: "List users"
      description: "Retrieves a paginated list of users"
      tags:
        - backoffice
      parameters:
        - name: X-Trace-ID
          in: header
          schema:
            $ref: "#/components/schemas/TraceId"
        - name: page
          in: query
          schema:
            type: integer
          description: "Page number for pagination"
        - name: per
          in: query
          schema:
            type: integer
          description: "Number of items per page"
      security:
        - Authentication: []
      responses:
        "200":
          description: "OK"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UsersListResponse"
        "401":
          description: "Unauthorized"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "422":
          description: "Unprocessable Entity"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
    post:
      summary: "Create a user"
      description: "Creates a new user with assigned role"
      tags:
        - backoffice
      parameters:
        - name: X-Trace-ID
          in: header
          schema:
            $ref: "#/components/schemas/TraceId"
      security:
        - Authentication: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserRequest"
      responses:
        "201":
          description: "Created"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserSerializer"
        "400":
          description: "Bad Request"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "401":
          description: "Unauthorized"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "422":
          description: "Unprocessable Entity"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"

  /api/backoffice/users/{id}:
    get:
      summary: "Get a user"
      description: "Retrieves a user by its ID"
      tags:
        - backoffice
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: "User ID"
        - name: X-Trace-ID
          in: header
          schema:
            $ref: "#/components/schemas/TraceId"
      security:
        - Authentication: []
      responses:
        "200":
          description: "OK"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserSerializer"
        "401":
          description: "Unauthorized"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "404":
          description: "Not Found"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "422":
          description: "Unprocessable Entity"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
    put:
      summary: "Update a user"
      description: "Updates a user by its ID"
      tags:
        - backoffice
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: "User ID"
        - name: X-Trace-ID
          in: header
          schema:
            $ref: "#/components/schemas/TraceId"
      security:
        - Authentication: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserRequest"
      responses:
        "200":
          description: "OK"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserSerializer"
        "400":
          description: "Bad Request"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "401":
          description: "Unauthorized"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "422":
          description: "Unprocessable Entity"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
    delete:
      summary: "Delete a user"
      description: "Deletes a user by its ID"
      tags:
        - backoffice
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: "User ID"
        - name: X-Trace-ID
          in: header
          schema:
            $ref: "#/components/schemas/TraceId"
      security:
        - Authentication: []
      responses:
        "204":
          description: "No Content"
        "401":
          description: "Unauthorized"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"
        "422":
          description: "Unprocessable Entity"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorSerializer"

components:
  securitySchemes:
    Authentication:
      type: http
      scheme: Bearer
  schemas:
    TraceId:
      type: string
      format: uuid
      example: "123e4567-e89b-12d3-a456-426614174000"
      description: "Unique trace identifier"

    CreateSmartIdSessionRequest:
      type: object
      properties:
        country:
          type: string
          description: "Country code (e.g., 'EE', 'LV', 'LT')"
        personal_code:
          type: string
          description: "Personal code of the user"
      required:
        - country
        - personal_code

    CreateMobileIdSessionRequest:
      type: object
      properties:
        personal_code:
          type: string
          description: "Personal code of the user"
        phone_number:
          type: string
          description: "User's phone number"
        locale:
          type: string
          description: "Locale preference (e.g., 'ENG', 'EST')."
      required:
        - personal_code
        - phone_number
        - locale

    RefreshAccessTokenRequest:
      type: object
      properties:
        refresh_token:
          type: string
          description: "JWT refresh token"
      required:
        - refresh_token

    PermissionRequest:
      type: object
      properties:
        name:
          type: string
          description: "Updated name of the permission"
        description:
          type: string
          description: "Updated description of the permission"
      required:
        - name
        - description

    RoleRequest:
      type: object
      properties:
        name:
          type: string
          description: "Name of the role"
        description:
          type: string
          description: "Description of the role"
      required:
        - name
        - description

    ScopeRequest:
      type: object
      properties:
        name:
          type: string
          description: "Name of the scope"
        description:
          type: string
          description: "Description of the scope"
      required:
        - name
        - description

    UserRequest:
      type: object
      properties:
        first_name:
          type: string
          description: "User's first name"
        last_name:
          type: string
          description: "User's last name"
        email:
          type: string
          format: email
          description: "User's email address"
        password:
          type: string
          format: password
          description: "User's password"
        role_id:
          type: string
          format: uuid
          description: "Role ID to assign to the user"
      required:
        - first_name
        - last_name
        - email
        - password
        - role_id

    SessionSerializer:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: "Unique session ID"
        code:
          type: string
          description: "Verification code displayed to the user"
        status:
          type: string
          description: "Current status of the session"
        error:
          type: string
          description: "Error message if the session is in an error state"
      required:
        - id

    UserSerializer:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: "User's unique ID"
        identity_number:
          type: string
          description: "User's identity number"
        personal_code:
          type: string
          description: "User's personal code"
        first_name:
          type: string
          description: "User's first name"
        last_name:
          type: string
          description: "User's last name"
        access_token:
          type: string
          description: "JWT access token"
        refresh_token:
          type: string
          description: "JWT refresh token"
      required:
        - id
        - identity_number
        - personal_code
        - first_name
        - last_name
        - access_token
        - refresh_token

    TokensSerializer:
      type: object
      properties:
        access_token:
          type: string
          description: "JWT access token"
        refresh_token:
          type: string
          description: "JWT refresh token"
      required:
        - access_token
        - refresh_token

    PermissionSerializer:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: "Permission's unique ID"
        name:
          type: string
          description: "Permission name"
        description:
          type: string
          description: "Permission description"
      required:
        - id
        - name
        - description

    RoleSerializer:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: "Role's unique ID"
        name:
          type: string
          description: "Role name"
        description:
          type: string
          description: "Role description"
      required:
        - id
        - name
        - description

    ScopeSerializer:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: "Scope's unique ID"
        name:
          type: string
          description: "Scope name"
        description:
          type: string
          description: "Scope description"
      required:
        - id
        - name
        - description

    PaginationMeta:
      type: object
      properties:
        page:
          type: integer
          description: "Current page number"
        per:
          type: integer
          description: "Number of items per page"
        total:
          type: integer
          description: "Total number of items"
      required:
        - page
        - per
        - total

    PermissionsListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/PermissionSerializer"
        meta:
          $ref: "#/components/schemas/PaginationMeta"
      required:
        - data
        - meta

    RolesListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/RoleSerializer"
        meta:
          $ref: "#/components/schemas/PaginationMeta"
      required:
        - data
        - meta

    ScopesListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/ScopeSerializer"
        meta:
          $ref: "#/components/schemas/PaginationMeta"
      required:
        - data
        - meta

    TokensListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/TokensSerializer"
        meta:
          $ref: "#/components/schemas/PaginationMeta"
      required:
        - data
        - meta

    UsersListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/UserSerializer"
        meta:
          $ref: "#/components/schemas/PaginationMeta"
      required:
        - data
        - meta

    ErrorSerializer:
      type: object
      properties:
        error:
          type: string
          description: "Error message describing what went wrong"
      required:
        - error
